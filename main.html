<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Leitura+ - Biblioteca</title>
<style>
  :root{
    --bg:#0b0b0d; --panel:#0f0f14; --card:#111217; --accent:#8a5cf6; --accent-2:#cfa3ff; --muted:#9aa0b4; --text:#e7e9ee; --glass: rgba(255,255,255,0.03); --success:#38d39f;
  }
  [data-theme="light"]{ 
    --bg:#f5f7fb; --panel:#ffffff; --card:#ffffff; --accent:#4f46e5; --accent-2:#8b5cf6; --muted:#64748b; --text:#081124; --glass: rgba(2,6,23,0.03); 
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial;background:linear-gradient(180deg,var(--bg),#050507);color:var(--text);-webkit-font-smoothing:antialiased}
  
  /* Header corrigido para modo claro */
  header{display:flex;align-items:center;justify-content:space-between;padding:12px 18px;background:var(--card);border-bottom:1px solid rgba(0,0,0,0.06)}
  [data-theme="light"] header{background:var(--panel);border-bottom:1px solid rgba(0,0,0,0.1)}
  
  .brand{display:flex;align-items:center;gap:12px}
  .logo-wrap{width:46px;height:46px;display:flex;align-items:center;justify-content:center;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));box-shadow:0 6px 20px rgba(138,92,246,0.12)}
  h1{margin:0;font-size:1rem}
  main{display:flex;gap:18px;padding:18px}
  nav.side{width:300px}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.02));border-radius:12px;padding:12px;border:1px solid rgba(255,255,255,0.03)}
  [data-theme="light"] .card{background:var(--card);border:1px solid rgba(0,0,0,0.08)}
  .muted{color:var(--muted)}
  .small{font-size:0.86rem}
  .menu{display:flex;flex-direction:column;gap:8px}
  .menu button{background:transparent;border:0;color:var(--muted);text-align:left;padding:10px;border-radius:8px;cursor:pointer}
  .menu button.active{background:rgba(138,92,246,0.08);color:var(--text)}
  [data-theme="light"] .menu button.active{background:rgba(79,70,229,0.08)}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:12px}
  .book{background:var(--card);border-radius:10px;padding:8px;display:flex;flex-direction:column;gap:8px;cursor:pointer;border:1px solid rgba(255,255,255,0.02)}
  [data-theme="light"] .book{background:var(--card);border:1px solid rgba(0,0,0,0.05)}
  .cover{width:100%;height:180px;border-radius:8px;overflow:hidden;display:flex;align-items:center;justify-content:center;background:#0a0a0d}
  [data-theme="light"] .cover{background:#f0f0f0}
  .cover img{width:100%;height:100%;object-fit:cover}
  .title{font-size:0.92rem;margin:0}
  .controls{display:flex;gap:8px;align-items:center}
  
  /* Bot√µes corrigidos - cores do texto sempre branco */
  .btn{background:linear-gradient(90deg,var(--accent),var(--accent-2));padding:8px 12px;border-radius:10px;border:0;color:#ffffff !important;cursor:pointer;font-weight:600}
  .ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:7px 10px;border-radius:8px;color:var(--text)}
  [data-theme="light"] .ghost{border:1px solid rgba(0,0,0,0.1);color:var(--text)}
  
  .badge{background:linear-gradient(90deg,var(--accent),var(--accent-2));padding:6px 8px;border-radius:999px;color:#ffffff !important;font-weight:700;font-size:0.75rem}
  .panel{display:flex;gap:12px}
  .panel .left{width:420px}
  .panel .right{flex:1}
  .book-full{display:flex;gap:12px}
  .thumb{width:200px;height:300px;border-radius:10px;overflow:hidden;background:#070708}
  [data-theme="light"] .thumb{background:#f0f0f0}
  .progress{height:10px;background:rgba(255,255,255,0.04);border-radius:999px;overflow:hidden}
  [data-theme="light"] .progress{background:rgba(0,0,0,0.08)}
  .progress > span{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--accent-2));transition:width 300ms}
  .toast-area{position:fixed;right:18px;top:70px;display:flex;flex-direction:column;gap:8px;z-index:50}
  .toast{background:var(--card);padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);box-shadow:0 8px 20px rgba(0,0,0,0.3);min-width:220px;color:var(--text)}
  [data-theme="light"] .toast{border:1px solid rgba(0,0,0,0.08)}
  .friend{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px}
  .dict-popup{position:fixed;background:var(--card);padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);z-index:60;max-width:300px;color:var(--text)}
  [data-theme="light"] .dict-popup{border:1px solid rgba(0,0,0,0.08)}
  footer{padding:18px;text-align:center;color:var(--muted);font-size:0.9rem}
  
  /* Inputs corrigidos */
  input, select, textarea {
    background:var(--glass) !important;
    border:1px solid rgba(255,255,255,0.03) !important;
    color:var(--text) !important;
    padding:8px;
    border-radius:8px;
  }
  [data-theme="light"] input, 
  [data-theme="light"] select, 
  [data-theme="light"] textarea {
    background:var(--glass) !important;
    border:1px solid rgba(0,0,0,0.1) !important;
    color:var(--text) !important;
  }
  
  /* Placeholder dos inputs */
  ::placeholder {
    color:var(--muted) !important;
  }
  
  @media(max-width:1000px){main{flex-direction:column}nav.side{width:100%}.panel .left{width:100%}}
</style>
</head>
<body data-theme="dark">
<header>
  <div style="display:flex;align-items:center;gap:12px">
    <div class="logo-wrap" title="Leitura+">
      <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden width="30" height="30"><defs><linearGradient id="g1" x1="0" x2="1"><stop offset="0" stop-color="#8a5cf6"/><stop offset="1" stop-color="#cfa3ff"/></linearGradient></defs><path d="M8 12c0 0 10-6 24-6s24 6 24 6v32c0 0-10-6-24-6S8 44 8 44V12z" fill="url(#g1)"/></svg>
    </div>
    <div>
      <h1>Leitura+</h1>
      <div class="small muted">Rede liter√°ria & leitura</div>
    </div>
    <div style="margin-left:20px">
      <input id="searchInput" placeholder="Pesquisar..." style="padding:8px;border-radius:8px;width:200px" />
    </div>
  </div>

  <div style="display:flex;gap:10px;align-items:center">
    <button class="ghost" id="btnTheme">Modo Claro</button>
    <button class="ghost" id="btnNotifications">üîî <span id="notifCount">0</span></button>
    <button class="btn" id="btnNewBook">+ Adicionar livro</button>
  </div>
</header>

<main>
  <nav class="side">
    <div class="card">
      <div style="display:flex;gap:12px;align-items:center">
        <div style="width:56px;height:56px;border-radius:10px;background:linear-gradient(180deg,#fff0,#fff1);display:flex;align-items:center;justify-content:center;font-weight:700;color:#12021a">EC</div>
        <div>
          <div style="font-weight:700" id="profileName">Eduarda Coimbra</div>
          <div class="muted small" id="profileEmail">eduarda@example.com</div>
        </div>
      </div>

      <div style="margin-top:12px" class="menu">
        <button class="active" data-view="library">Biblioteca</button>
        <button data-view="gibis">Gibis</button>
        <button data-view="shelf">Minha Estante</button>
        <button data-view="playlist">Playlists</button>
        <button data-view="friends">Amigos</button>
        <button data-view="profile">Perfil</button>
      </div>
    </div>

    <div style="height:12px"></div>

    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div class="small muted">Estat√≠sticas</div>
          <div style="font-weight:700">Leituras: <span id="statReads">12</span></div>
        </div>
        <div style="text-align:right">
          <div class="small muted">Seguindo</div>
          <div style="font-weight:700" id="statFollowing">8</div>
        </div>
      </div>

      <div style="margin-top:10px">
        <h4 style="margin:0">Playlists favoritas</h4>
        <div style="display:flex;flex-direction:column;gap:6px;margin-top:8px">
          <a href="#" data-link="https://open.spotify.com/playlist/37i9dQZF1DXcBWIGoYBM5M" class="small muted playlist-link">Top Relax</a>
          <a href="#" data-link="https://open.spotify.com/playlist/37i9dQZF1DX4sWSpwq3LiO" class="small muted playlist-link">Focus Beats</a>
          <a href="#" data-link="#" class="small muted playlist-link" id="userPlaylist">Minha playlist (vazia)</a>
        </div>
      </div>
    </div>
  </nav>

  <section class="content" style="flex:1;display:flex;flex-direction:column;gap:14px">
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <h2 style="margin:0">Explorar</h2>
          <div class="small muted">Encontre livros, gibis e playlists</div>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <select id="filterGenre" style="padding:8px;border-radius:8px;width:150px"></select>
          <button class="ghost" id="btnSort">Ordenar: T√≠tulo</button>
        </div>
      </div>

      <div style="margin-top:12px">
        <div id="sectionGrid" class="grid" aria-live="polite"></div>
      </div>
    </div>

    <div id="viewBook" style="display:none">
      <div class="card">
        <div class="panel">
          <div class="left">
            <div class="book-full">
              <div class="thumb" id="fullCoverWrap"><img src="" alt="capa" style="width:100%;height:100%;object-fit:cover"></div>
              <div class="info">
                <h2 id="fullTitle">T√≠tulo</h2>
                <div class="muted" id="fullAuthor">Autor</div>
                <div style="margin-top:8px"><span class="small muted">G√™nero: <span id="infoGenre"></span></span></div>
                <p class="muted small" id="fullDesc" style="margin-top:10px;line-height:1.5">Descri√ß√£o do livro...</p>

                <div style="margin-top:12px" class="row controls">
                  <button class="btn" id="btnFavorite">‚ô° Favoritar</button>
                  <button class="ghost" id="btnAddShelf">+ Minha Estante</button>
                  <button class="ghost" id="btnFollowAuthor">Seguir autor</button>
                  <a id="spotifyLink" class="ghost" target="_blank" href="#">Ouvir (spotify)</a>
                  <button class="ghost" id="btnBack">Voltar</button>
                </div>

                <div style="margin-top:12px">
                  <div class="small muted">Progresso de leitura</div>
                  <div class="progress" style="margin-top:6px"><span id="progressBar" style="width:0%"></span></div>
                  <div style="display:flex;gap:8px;margin-top:8px;align-items:center">
                    <input id="progressRange" type="range" min="0" max="100" value="0" />
                    <div class="small muted" id="progressLabel">0%</div>
                  </div>
                </div>

              </div>
            </div>

            <div style="margin-top:14px">
              <h3 style="margin:0">Coment√°rios</h3>
              <div id="commentsArea" class="comments" style="margin-top:8px"></div>

              <div style="margin-top:8px;display:flex;gap:8px">
                <input id="commentUser" class="input" placeholder="Seu nome" style="flex:0 0 160px;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:var(--text)" />
                <input id="commentText" class="input" placeholder="Escreva um coment√°rio..." style="flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:var(--text)" />
                <button class="btn" id="btnAddComment">Comentar</button>
              </div>
            </div>
          </div>

          <div class="right">
            <div class="card">
              <h4 style="margin:0">Detalhes</h4>
              <div style="margin-top:8px" class="small muted">P√°ginas: <span id="infoPages"></span></div>
              <div class="small muted" style="margin-top:6px">Editora: <span id="infoPublisher"></span></div>
              <div class="small muted" style="margin-top:6px">ISBN: <span id="infoISBN"></span></div>

              <div style="margin-top:12px">
                <h4 style="margin:0">Chat (demo)</h4>
                <div id="chatBox" class="chat-box small muted" style="height:120px;overflow:auto;padding:8px;background:transparent;border:1px solid rgba(255,255,255,0.02)"></div>
                <div style="margin-top:8px;display:flex;gap:8px">
                  <input id="chatName" class="input" placeholder="Nome" style="flex:0 0 120px;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:var(--text)" />
                  <input id="chatMsg" class="input" placeholder="Mensagem" style="flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:var(--text)" />
                  <button class="btn" id="btnSendChat">Enviar</button>
                </div>
              </div>
            </div>

            <div style="height:12px"></div>

            <div class="card">
              <h4 style="margin:0">Sugest√µes</h4>
              <div id="suggestions" style="margin-top:8px" class="small muted"></div>
            </div>

          </div>
        </div>
      </div>
    </div>

    <div id="viewShelf" style="display:none">
      <div class="card">
        <h3>Minha Estante</h3>
        <div id="shelfGrid" class="grid" style="margin-top:10px"></div>
      </div>
    </div>

    <div id="viewGibis" style="display:none">
      <div class="card">
        <h3>Gibis</h3>
        <div id="gibisGrid" class="grid" style="margin-top:10px"></div>
      </div>
    </div>

    <div id="viewFriends" style="display:none">
      <div class="card">
        <h3>Amigos</h3>
        <div id="friendsList" style="margin-top:8px"></div>
      </div>
    </div>

  </section>
</main>

<div class="toast-area" id="toastArea"></div>
<div id="dictPopup" class="dict-popup" style="display:none"></div>

<footer>
  ¬© 2025 Leitura+ ‚Äî Demo interativa.
</footer>

<script>
// --- Sistema Organizado ---
class LeituraPlusApp {
  constructor() {
    // APENAS OS LIVROS QUE VOC√ä QUER
    this.BOOKS = [
      {
        id: 1,
        title: "O Hobbit",
        author: "J.R.R. Tolkien",
        cover: "https://m.media-amazon.com/images/I/91b0C2YNSrL._AC_UF1000,1000_QL80_.jpg",
        genre: "Fantasia",
        pages: 310,
        publisher: "HarperCollins",
        year: 1937,
        isbn: "978-0006754022",
        description: "O Hobbit conta a hist√≥ria de Bilbo Bolseiro, um hobbit que se junta a uma jornada √©pica para recuperar um tesouro guardado por um drag√£o."
      },
      {
        id: 2,
        title: "1984",
        author: "George Orwell",
        cover: "https://m.media-amazon.com/images/I/71kxa1-0mfL._AC_UF1000,1000_QL80_.jpg",
        genre: "Fic√ß√£o Cient√≠fica",
        pages: 328,
        publisher: "Companhia das Letras",
        year: 1949,
        isbn: "978-8535914849",
        description: "Um cl√°ssico dist√≥pico sobre vigil√¢ncia governamental e controle totalit√°rio em um futuro sombrio."
      },
      {
        id: 3,
        title: "O Pequeno Pr√≠ncipe",
        author: "Antoine de Saint-Exup√©ry",
        cover: "profileImages/download.jpg",
        genre: "Literatura Infantil",
        pages: 96,
        publisher: "Agir",
        year: 1943,
        isbn: "978-8522005230",
        description: "Uma f√°bula po√©tica sobre amizade, amor e a ess√™ncia da vida, contada por um pequeno pr√≠ncipe de um asteroide distante."
      },
      {
        id: 4,
        title: "Orgulho e Preconceito",
        author: "Jane Austen",
        cover: "https://m.media-amazon.com/images/I/71Q1tPupKjL._AC_UF1000,1000_QL80_.jpg",
        genre: "Romance",
        pages: 432,
        publisher: "Penguin Classics",
        year: 1813,
        isbn: "978-0141439518",
        description: "Um dos romances mais famosos da literatura inglesa, explorando temas de amor, classe social e preconceito na Inglaterra rural."
      },
      {
        id: 5,
        title: "A Revolu√ß√£o dos Bichos",
        author: "George Orwell",
        cover: "profileImages/download (2).jpg",
        genre: "S√°tira Pol√≠tica",
        pages: 152,
        publisher: "Companhia das Letras",
        year: 1945,
        isbn: "978-8535913226",
        description: "Uma f√°bula sat√≠rica sobre os animais de uma fazenda que se rebelam contra seus donos humanos, mas acabam criando uma tirania ainda pior."
      },
      {
        id: 6,
        title: "Senhor dos An√©is ‚Äî A Sociedade do Anel",
        author: "J.R.R. Tolkien",
        cover: "https://m.media-amazon.com/images/I/71jLBXtWJWL._AC_UF1000,1000_QL80_.jpg",
        genre: "Fantasia",
        pages: 576,
        publisher: "HarperCollins",
        year: 1954,
        isbn: "978-0007525543",
        description: "O primeiro volume da trilogia √©pica que segue a jornada de Frodo Bolseiro para destruir o Um Anel na Montanha da Perdi√ß√£o."
      },
      {
        id: 7,
        title: "Clean Code",
        author: "Robert C. Martin",
        cover: "https://m.media-amazon.com/images/I/41xShlnTZTL._SX374_BO1,204,203,200_.jpg",
        genre: "Programa√ß√£o",
        pages: 464,
        publisher: "Pearson",
        year: 2008,
        isbn: "978-0132350884",
        description: "Um guia essencial para desenvolvedores sobre como escrever c√≥digo limpo, leg√≠vel e sustent√°vel."
      },
      {
        id: 8,
        title: "Dom Casmurro",
        author: "Machado de Assis",
        cover: "profileImages/download (1).jpg",
        genre: "Cl√°ssico",
        pages: 256,
        publisher: "Penguin Classics",
        year: 1899,
        isbn: "978-8535914849",
        description: "Romance cl√°ssico da literatura brasileira que narra a hist√≥ria de Bentinho e sua desconfian√ßa sobre a fidelidade de Capitu, explorando temas como ci√∫me, trai√ß√£o e mem√≥ria."
      }
    ];
    
    this.currentBook = null;
    
    // Chaves do localStorage
    this.LS_KEYS = {
      FAV: 'leituraplus_favorites_v2',
      SHELF: 'leituraplus_shelf_v2',
      PROGRESS: 'leituraplus_progress_v2',
      FOLLOW: 'leituraplus_follow_v2',
      NOTIFS: 'leituraplus_notifs_v2',
      COMMENTS: 'leituraplus_comments_v1'
    };
    
    // Estado
    this.favorites = JSON.parse(localStorage.getItem(this.LS_KEYS.FAV) || '[]');
    this.shelf = JSON.parse(localStorage.getItem(this.LS_KEYS.SHELF) || '[]');
    this.progress = JSON.parse(localStorage.getItem(this.LS_KEYS.PROGRESS) || '{}');
    this.follows = JSON.parse(localStorage.getItem(this.LS_KEYS.FOLLOW) || '[]');
    this.notifs = JSON.parse(localStorage.getItem(this.LS_KEYS.NOTIFS) || '[]');
    
    this.init();
  }

  // --- Inicializa√ß√£o ---
  init() {
    this.populateGenreFilter();
    this.renderGrid(this.BOOKS, document.getElementById('sectionGrid'));
    this.renderShelf();
    this.renderGibis();
    this.renderFriends();
    this.updateNotifCount();
    this.setupEventListeners();
    this.showView('library');
  }

  // --- Utilit√°rios ---
  escapeHtml(s) { 
    return String(s || '').replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;'); 
  }

  qs(sel) { return document.querySelector(sel); }
  qsa(sel) { return Array.from(document.querySelectorAll(sel)); }

  // --- Renderizadores ---
  uniqueGenres() { 
    return Array.from(new Set(this.BOOKS.map(b => b.genre))).sort(); 
  }

  populateGenreFilter() {
    const filterGenre = this.qs('#filterGenre');
    const genres = this.uniqueGenres();
    filterGenre.innerHTML = '';
    
    const opt = document.createElement('option');
    opt.value = '';
    opt.textContent = 'Todos';
    filterGenre.appendChild(opt);
    
    genres.forEach(g => {
      const o = document.createElement('option');
      o.value = g;
      o.textContent = g;
      filterGenre.appendChild(o);
    });
  }

  renderGrid(list, container) {
    container.innerHTML = '';
    list.forEach(book => {
      const el = document.createElement('div');
      el.className = 'book';
      el.dataset.id = book.id;
      el.innerHTML = `
        <div class="cover"><img src="${book.cover}" alt="${this.escapeHtml(book.title)}" onerror="this.src='https://via.placeholder.com/400x600.png?text=Capa+N√£o+Encontrada'"></div>
        <div>
          <div class="title">${this.escapeHtml(book.title)}</div>
          <div class="small muted">${this.escapeHtml(book.author)}</div>
          <div style="display:flex;justify-content:space-between;align-items:center;margin-top:6px">
            <div class="small muted">${this.escapeHtml(book.genre)}</div>
            <div style="display:flex;gap:6px">
              <button class="ghost btn-open" data-id="${book.id}">Abrir</button>
              ${this.favorites.includes(book.id) ? 
                '<button class="btn btn-unfav" data-id="' + book.id + '">‚ô•</button>' : 
                '<button class="ghost btn-fav" data-id="' + book.id + '">‚ô°</button>'}
            </div>
          </div>
        </div>
      `;
      container.appendChild(el);
    });
  }

  // --- Event Listeners ---
  setupEventListeners() {
    // Pesquisa e filtros
    this.qs('#searchInput').addEventListener('input', e => {
      const q = e.target.value.trim().toLowerCase();
      const g = this.qs('#filterGenre').value;
      let res = this.BOOKS.filter(b => 
        (!g || b.genre === g) && 
        (b.title + b.author + b.genre).toLowerCase().includes(q)
      );
      this.renderGrid(res, this.qs('#sectionGrid'));
    });

    this.qs('#filterGenre').addEventListener('change', () => {
      this.qs('#searchInput').dispatchEvent(new Event('input'));
    });

    this.qs('#btnSort').addEventListener('click', () => {
      this.BOOKS.sort((a, b) => a.title.localeCompare(b.title));
      this.renderGrid(this.BOOKS, this.qs('#sectionGrid'));
    });

    // Grid de livros
    this.qs('#sectionGrid').addEventListener('click', e => {
      if (e.target.matches('.btn-open')) {
        this.openBookDetail(e.target.dataset.id);
      }
      if (e.target.matches('.btn-fav')) {
        this.toggleFavorite(Number(e.target.dataset.id));
        this.renderGrid(this.BOOKS, this.qs('#sectionGrid'));
      }
      if (e.target.matches('.btn-unfav')) {
        this.toggleFavorite(Number(e.target.dataset.id));
        this.renderGrid(this.BOOKS, this.qs('#sectionGrid'));
      }
    });

    // Navega√ß√£o
    this.qsa('.menu button').forEach(b => {
      b.addEventListener('click', () => {
        this.qsa('.menu button').forEach(x => x.classList.remove('active'));
        b.classList.add('active');
        this.showView(b.dataset.view);
      });
    });

    // Detalhes do livro
    this.qs('#btnBack').addEventListener('click', () => {
      this.qs('#viewBook').style.display = 'none';
      this.qs('#sectionGrid').closest('.card').style.display = '';
    });

    this.qs('#btnFavorite').addEventListener('click', () => {
      this.toggleFavorite(this.currentBook.id);
      this.updateFavoriteButton();
      this.renderShelf();
    });

    this.qs('#btnAddShelf').addEventListener('click', () => {
      if (!this.shelf.includes(this.currentBook.id)) {
        this.shelf.unshift(this.currentBook.id);
        localStorage.setItem(this.LS_KEYS.SHELF, JSON.stringify(this.shelf));
        this.pushNotif('Adicionado √† Minha Estante');
        this.renderShelf();
      }
    });

    // Coment√°rios
    this.qs('#btnAddComment').addEventListener('click', () => {
      const name = this.qs('#commentUser').value.trim() || 'Visitante';
      const text = this.qs('#commentText').value.trim();
      if (!text) return alert('Escreva um coment√°rio.');
      
      const all = this.loadComments();
      if (!all[this.currentBook.id]) all[this.currentBook.id] = [];
      all[this.currentBook.id].unshift({
        name,
        text,
        date: new Date().toLocaleString()
      });
      
      this.saveComments(all);
      this.qs('#commentText').value = '';
      this.renderComments(this.currentBook.id);
      this.pushNotif(`${name} comentou em ${this.currentBook.title}`);
    });

    // Chat
    this.qs('#btnSendChat').addEventListener('click', () => {
      const name = this.qs('#chatName').value.trim() || 'Anon';
      const text = this.qs('#chatMsg').value.trim();
      if (!text) return;
      
      const key = 'leituraplus_chat_' + this.currentBook.id;
      const arr = localStorage.getItem(key) ? JSON.parse(localStorage.getItem(key)) : [];
      arr.push({
        name,
        text,
        date: new Date().toLocaleTimeString()
      });
      
      localStorage.setItem(key, JSON.stringify(arr));
      this.qs('#chatMsg').value = '';
      this.renderChat(this.currentBook.id);
      this.pushNotif(`${name} enviou mensagem no chat de ${this.currentBook.title}`);
    });

    // Progresso
    this.qs('#progressRange').addEventListener('input', e => {
      const v = Number(e.target.value);
      this.qs('#progressBar').style.width = v + '%';
      this.qs('#progressLabel').textContent = v + '%';
    });

    this.qs('#progressRange').addEventListener('change', e => {
      const v = Number(e.target.value);
      this.progress[this.currentBook.id] = v;
      localStorage.setItem(this.LS_KEYS.PROGRESS, JSON.stringify(this.progress));
      this.pushNotif(`Progresso salvo: ${v}% em ${this.currentBook.title}`);
      this.renderShelf();
    });

    // Notifica√ß√µes
    this.qs('#btnNotifications').addEventListener('click', () => {
      const list = this.notifs.slice(0, 10);
      if (!list.length) return alert('Sem notifica√ß√µes');
      
      let text = 'Notifica√ß√µes:\n\n';
      list.forEach(n => text += `${n.date} ‚Äî ${n.text}\n`);
      alert(text);
      
      this.notifs = [];
      localStorage.setItem(this.LS_KEYS.NOTIFS, JSON.stringify(this.notifs));
      this.updateNotifCount();
    });

    // Tema
    this.qs('#btnTheme').addEventListener('click', () => {
      const body = document.body;
      const cur = body.getAttribute('data-theme');
      if (cur === 'dark') {
        body.setAttribute('data-theme', 'light');
        this.qs('#btnTheme').textContent = 'Modo Escuro';
      } else {
        body.setAttribute('data-theme', 'dark');
        this.qs('#btnTheme').textContent = 'Modo Claro';
      }
    });

    // Novo livro
    this.qs('#btnNewBook').addEventListener('click', () => {
      const t = prompt('T√≠tulo do livro (mock):', 'Novo Livro Exemplo');
      if (!t) return;
      
      const book = {
        id: this.BOOKS.length + 1,
        title: t,
        author: 'Autor Demo',
        cover: 'https://via.placeholder.com/400x600.png?text=' + encodeURIComponent(t),
        genre: 'Geral',
        pages: 200,
        publisher: 'Editora Demo',
        year: 2025,
        isbn: '000-0000000000',
        description: 'Descri√ß√£o do novo livro adicionado.'
      };
      
      this.BOOKS.unshift(book);
      this.renderGrid(this.BOOKS, this.qs('#sectionGrid'));
      this.pushNotif('Livro adicionado (mock)');
    });

    // Playlist do usu√°rio
    this.qs('#userPlaylist').addEventListener('click', e => {
      e.preventDefault();
      const url = prompt('Cole o link da sua playlist Spotify (simulado):', 'https://open.spotify.com/');
      if (!url) return;
      
      this.qs('#userPlaylist').dataset.link = url;
      this.qs('#userPlaylist').textContent = 'Minha playlist (salva)';
      localStorage.setItem('leituraplus_user_playlist', url);
    });

    // Dicion√°rio
    this.qs('#fullDesc').addEventListener('mouseup', e => {
      const sel = window.getSelection().toString().trim();
      if (sel.length > 0) {
        const rect = window.getSelection().getRangeAt(0).getBoundingClientRect();
        this.showDictFor(sel, rect.left + window.scrollX, rect.bottom + window.scrollY);
      }
    });

    // Amigos
    this.qs('#friendsList').addEventListener('click', e => {
      if (e.target.matches('.btn-follow')) {
        const id = Number(e.target.dataset.id);
        if (this.follows.includes(id)) {
          this.follows = this.follows.filter(x => x !== id);
          this.pushNotif('Deixou de seguir um amigo');
        } else {
          this.follows.push(id);
          this.pushNotif('Voc√™ est√° seguindo um amigo');
        }
        localStorage.setItem(this.LS_KEYS.FOLLOW, JSON.stringify(this.follows));
        this.renderFriends();
        this.updateFollowStats();
      }
    });
  }

  // --- Funcionalidades Principais ---
  <!-- No script da main.html, modifique a fun√ß√£o openBookDetail: -->

  openBookDetail(id) {
    const book = this.BOOKS.find(b => b.id == id);
    if (!book) return;
    
    // Redirecionar para view.html com os dados do livro
    const bookData = encodeURIComponent(JSON.stringify(book));
    window.location.href = `view.html?book=${bookData}`;
  }

  showView(v) {
    this.qs('#sectionGrid').closest('.card').style.display = v === 'library' ? '' : 'none';
    this.qs('#viewBook').style.display = 'none';
    this.qs('#viewShelf').style.display = v === 'shelf' ? '' : 'none';
    this.qs('#viewGibis').style.display = v === 'gibis' ? '' : 'none';
    this.qs('#viewFriends').style.display = v === 'friends' ? '' : 'none';
    
    if (v === 'shelf') {
      this.renderShelf();
    }
    if (v === 'gibis') {
      this.renderGibis();
    }
  }

  // --- Favoritos ---
  toggleFavorite(id) {
    if (this.favorites.includes(id)) {
      this.favorites = this.favorites.filter(x => x !== id);
      this.pushNotif('Removido dos favoritos');
    } else {
      this.favorites.push(id);
      this.pushNotif('Adicionado aos favoritos');
    }
    localStorage.setItem(this.LS_KEYS.FAV, JSON.stringify(this.favorites));
  }

  updateFavoriteButton() {
    if (!this.currentBook) return;
    this.qs('#btnFavorite').textContent = this.favorites.includes(this.currentBook.id) ? 
      '‚ô• Favorito' : '‚ô° Favoritar';
  }

  // --- Estante ---
  renderShelf() {
    const el = this.qs('#shelfGrid');
    el.innerHTML = '';
    const list = this.shelf.map(id => this.BOOKS.find(b => b.id === id)).filter(Boolean);
    
    if (!list.length) {
      el.innerHTML = '<div class="muted">Sua estante est√° vazia ‚Äî adicione livros!</div>';
    } else {
      this.renderGrid(list, el);
    }
  }

  // --- Gibis ---
  renderGibis() {
    const el = this.qs('#gibisGrid');
    const list = this.BOOKS.filter(b => b.genre === 'Gibi');
    if (list.length === 0) {
      el.innerHTML = '<div class="muted">Nenhum gibi encontrado.</div>';
    } else {
      this.renderGrid(list, el);
    }
  }

  // --- Coment√°rios ---
  loadComments() {
    const s = localStorage.getItem(this.LS_KEYS.COMMENTS);
    return s ? JSON.parse(s) : {};
  }

  saveComments(obj) {
    localStorage.setItem(this.LS_KEYS.COMMENTS, JSON.stringify(obj));
  }

  renderComments(bookId) {
    const area = this.qs('#commentsArea');
    const all = this.loadComments();
    const arr = all[bookId] || [];
    
    area.innerHTML = '';
    if (!arr.length) {
      area.innerHTML = '<div class="muted">Sem coment√°rios ‚Äî seja o primeiro!</div>';
    } else {
      arr.forEach((c, idx) => {
        const d = document.createElement('div');
        d.className = 'comment';
        d.style.border = '1px solid rgba(255,255,255,0.02)';
        d.style.padding = '8px';
        d.style.borderRadius = '8px';
        d.innerHTML = `
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <b>${this.escapeHtml(c.name)}</b>
              <div class="small muted">${this.escapeHtml(c.date)}</div>
            </div>
            <button class="ghost" data-idx="${idx}" data-book="${bookId}">Excluir</button>
          </div>
          <div style="margin-top:6px">${this.escapeHtml(c.text)}</div>
        `;
        area.appendChild(d);
      });
    }
    
    // Adicionar event listeners para excluir coment√°rios
    area.querySelectorAll('.ghost').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const bookId = e.target.dataset.book;
        const idx = Number(e.target.dataset.idx);
        const all = this.loadComments();
        if (!all[bookId]) return;
        
        if (confirm('Excluir coment√°rio?')) {
          all[bookId].splice(idx, 1);
          this.saveComments(all);
          this.renderComments(bookId);
        }
      });
    });
  }

  // --- Chat ---
  renderChat(bookId) {
    const key = 'leituraplus_chat_' + bookId;
    const arr = localStorage.getItem(key) ? JSON.parse(localStorage.getItem(key)) : [];
    const box = this.qs('#chatBox');
    
    box.innerHTML = '';
    if (!arr.length) {
      box.innerHTML = '<div class="muted">Nenhuma mensagem ‚Äî inicie a conversa!</div>';
    } else {
      arr.forEach(m => {
        const p = document.createElement('div');
        p.className = 'small';
        p.innerHTML = `
          <b>${this.escapeHtml(m.name)}</b> 
          <span class="muted">(${this.escapeHtml(m.date)})</span>
          <div>${this.escapeHtml(m.text)}</div>
        `;
        box.appendChild(p);
      });
    }
    box.scrollTop = box.scrollHeight;
  }

  // --- Progresso ---
  renderProgress(bookId) {
    const val = this.progress[bookId] || 0;
    this.qs('#progressBar').style.width = val + '%';
    this.qs('#progressRange').value = val;
    this.qs('#progressLabel').textContent = val + '%';
  }

  // --- Amigos ---
  renderFriends() {
    const sampleFriends = [
      {id:1, name:'Camila R.', status:'Lendo Clean Code'},
      {id:2, name:'Lucas M.', status:'Comentou Dom Casmurro'},
      {id:3, name:'Beatriz S.', status:'Seguindo a saga'}
    ];
    
    const el = this.qs('#friendsList');
    el.innerHTML = '';
    
    sampleFriends.forEach(f => {
      const d = document.createElement('div');
      d.className = 'friend';
      d.innerHTML = `
        <div>
          <b>${f.name}</b>
          <div class="small muted">${f.status}</div>
        </div>
        <div>
          <button class="ghost btn-follow" data-id="${f.id}">
            ${this.follows.includes(f.id) ? 'Seguindo' : 'Seguir'}
          </button>
        </div>
      `;
      el.appendChild(d);
    });
  }

  updateFollowStats() {
    this.qs('#statFollowing').textContent = this.follows.length;
  }

  // --- Notifica√ß√µes ---
  pushNotif(text) {
    const item = {
      text,
      date: new Date().toLocaleString()
    };
    
    this.notifs.unshift(item);
    localStorage.setItem(this.LS_KEYS.NOTIFS, JSON.stringify(this.notifs));
    this.showToast(item);
    this.updateNotifCount();
  }

  showToast(item) {
    const area = this.qs('#toastArea');
    const t = document.createElement('div');
    t.className = 'toast';
    t.textContent = item.text;
    area.appendChild(t);
    
    setTimeout(() => {
      t.style.opacity = '0';
      t.style.transition = 'opacity 400ms';
      setTimeout(() => t.remove(), 400);
    }, 4000);
  }

  updateNotifCount() {
    this.qs('#notifCount').textContent = this.notifs.length || 0;
  }

  // --- Sugest√µes ---
  renderSuggestions(genre) {
    const sug = this.BOOKS
      .filter(b => b.genre === genre && b.id !== this.currentBook.id)
      .slice(0, 4)
      .map(b => b.title)
      .join(', ');
    
    this.qs('#suggestions').textContent = sug || 'Sem sugest√µes';
  }

  // --- Dicion√°rio ---
  showDictFor(word, x, y) {
    const DICT = {
      'algoritmo': 'Conjunto de instru√ß√µes passo a passo para resolver um problema.',
      'classe': 'Estrutura que define objetos em programa√ß√£o orientada a objetos.',
      'vari√°vel': 'Espa√ßo de armazenamento nomeado para dados.',
      'hobbit': 'Criatura fict√≠cia da Terra-m√©dia, conhecida por ser pequena e viver em buracos confort√°veis.',
      'distopia': 'Sociedade imagin√°ria onde h√° grande sofrimento ou injusti√ßa.',
      'pr√≠ncipe': 'Filho de um rei ou governante; pessoa de alta posi√ß√£o social.',
      'preconceito': 'Opini√£o formada antecipadamente sem conhecimento adequado.',
      'revolu√ß√£o': 'Mudan√ßa radical e abrupta em uma sociedade ou sistema.',
      'anel': 'Objeto circular usado como joia ou s√≠mbolo de poder.',
      'c√≥digo': 'Conjunto de instru√ß√µes escritas em linguagem de programa√ß√£o.'
    };
    
    const popup = this.qs('#dictPopup');
    const def = DICT[word.toLowerCase()] || 'Defini√ß√£o n√£o encontrada (simulada).';
    
    popup.innerHTML = `
      <b>${this.escapeHtml(word)}</b>
      <div class="small muted" style="margin-top:6px">${this.escapeHtml(def)}</div>
    `;
    popup.style.left = x + 'px';
    popup.style.top = y + 'px';
    popup.style.display = 'block';
    
    setTimeout(() => popup.style.display = 'none', 7000);
  }
}

// Inicializar a aplica√ß√£o quando o DOM estiver carregado
document.addEventListener('DOMContentLoaded', () => {
  window.app = new LeituraPlusApp();
});

// Simular atividade de amigos (demo)
setInterval(() => {
  if (window.app) {
    const sampleFriends = [
      {id:1, name:'Camila R.', status:'Lendo Clean Code'},
      {id:2, name:'Lucas M.', status:'Comentou Dom Casmurro'},
      {id:3, name:'Beatriz S.', status:'Seguindo a saga'}
    ];
    
    const f = sampleFriends[Math.floor(Math.random() * sampleFriends.length)];
    const b = window.app.BOOKS[Math.floor(Math.random() * window.app.BOOKS.length)];
    window.app.pushNotif(`${f.name} comentou em ${b.title}`);
  }
}, 25000);
</script>
</body>
</html>