<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Leitura+ â€” Chat do Livro</title>
<style>
    :root {
        --bg:#0b0b0d;
        --card:#111217;
        --panel:#0f0f14;
        --accent:#8a5cf6;
        --accent-2:#cfa3ff;
        --muted:#9aa0b4;
        --text:#e7e9ee;
    }

    body {
        margin: 0;
        font-family: Inter, sans-serif;
        background: linear-gradient(180deg, var(--bg), #050507);
        color: var(--text);
        height: 100vh;
        display: flex;
        flex-direction: column;
    }

    header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 14px 20px;
        background: var(--card);
        border-bottom: 1px solid rgba(255,255,255,0.06);
    }

    .logo {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .logo-icon {
        width: 42px;
        height: 42px;
        border-radius: 10px;
        background: linear-gradient(135deg, var(--accent), var(--accent-2));
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 700;
        font-size: 1.2rem;
    }

    .container {
        display: grid;
        grid-template-columns: 220px 1fr 220px;
        flex: 1;
        height: calc(100vh - 70px);
    }

    .users-panel, .chats-panel {
        background: var(--panel);
        padding: 20px;
        overflow-y: auto;
        border-right: 1px solid rgba(255,255,255,0.05);
    }

    .chats-panel {
        border-right: none;
        border-left: 1px solid rgba(255,255,255,0.05);
    }

    .panel-title {
        margin-bottom: 16px;
        font-size: 1rem;
        color: var(--accent-2);
        font-weight: 600;
    }

    .user {
        display: flex;
        align-items: center;
        gap: 10px;
        background: rgba(255,255,255,0.04);
        border-radius: 8px;
        padding: 8px;
        margin-bottom: 8px;
        border: 1px solid rgba(255,255,255,0.03);
    }

    .avatar {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        overflow: hidden;
    }

    .avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .chat-area {
        padding: 20px;
        display: flex;
        justify-content: center;
    }

    .chat-card {
        width: 100%;
        max-width: 680px;
        background: var(--card);
        border: 1px solid rgba(255,255,255,0.05);
        border-radius: 14px;
        padding: 18px;
        display: flex;
        flex-direction: column;
        gap: 14px;
    }

    .chat-header {
        text-align: center;
        padding-bottom: 16px;
        border-bottom: 1px solid rgba(255,255,255,0.05);
    }

    #chatMessages {
        height: 400px;
        overflow-y: auto;
        padding-right: 10px;
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .msg {
        background: rgba(255,255,255,0.04);
        padding: 10px 14px;
        border-radius: 10px;
        max-width: 80%;
        border: 1px solid rgba(255,255,255,0.03);
    }

    .msg.self {
        align-self: flex-end;
        background: linear-gradient(90deg, var(--accent), var(--accent-2));
        color: white;
    }

    .chat-input-area {
        display: flex;
        gap: 10px;
    }

    input {
        flex: 1;
        padding: 12px;
        border-radius: 10px;
        background: #1a1c22;
        border: 1px solid rgba(255,255,255,0.05);
        color: white;
        outline: none;
    }

    button {
        background: linear-gradient(90deg, var(--accent), var(--accent-2));
        border: none;
        padding: 12px 16px;
        border-radius: 10px;
        font-weight: bold;
        color: white;
        cursor: pointer;
    }

    .chat-item {
        background: rgba(255,255,255,0.04);
        border-radius: 10px;
        padding: 10px;
        margin-bottom: 12px;
        cursor: pointer;
        border: 1px solid rgba(255,255,255,0.03);
    }

    .chat-item:hover {
        background: rgba(255,255,255,0.08);
    }
</style>
</head>
<body>
    <header>
        <div class="logo">
            <div class="logo-icon">L+</div>
            <div>
                <div style="font-size:1.1rem;font-weight:700;">Leitura+</div>
                <div style="font-size:0.8rem;color:var(--muted)" id="chatTitle">Chat de Grupo</div>
            </div>
        </div>
        <button onclick="window.history.back()">Voltar</button>
    </header>

    <div class="container">
        <div class="users-panel">
            <div class="panel-title">ðŸ‘¥ Participantes</div>
            <div class="user">
                <div class="avatar">
                    <img src="profileImages/images (1).jpg">
                </div>
                VocÃª
            </div>
            <div class="user">
                <div class="avatar">
                    <img src="profileImages/images.jpg">
                </div>
                JoÃ£o Pedro
            </div>
            <div class="user">
                <div class="avatar">
                    <img src="profileImages/images (2).jpg">
                </div>
                Ana Martins
            </div>
            <div class="user">
                <div class="avatar">
                    <img src="profileImages/images (4).jpg">
                </div>
                Lucas Silva
            </div>
        </div>

        <div class="chat-area">
            <div class="chat-card">
                <div class="chat-header">
                    <h2 id="bookChatTitle">Chat da Comunidade</h2>
                    <div class="muted" id="bookChatSubtitle">Converse com outros leitores</div>
                </div>
                
                <div id="chatMessages"></div>
                
                <div class="chat-input-area">
                    <input id="msgInput" placeholder="Escreva uma mensagem...">
                    <button onclick="sendMessage()">Enviar</button>
                </div>
            </div>
        </div>

        <div class="chats-panel">
            <div class="panel-title">ðŸ“š Outros chats</div>
            <div class="chat-item" onclick="changeChat('Dom Casmurro')">Dom Casmurro</div>
            <div class="chat-item" onclick="changeChat('O Hobbit')">O Hobbit</div>
            <div class="chat-item" onclick="changeChat('1984')">1984</div>
            <div class="chat-item" onclick="changeChat('Clean Code')">Clean Code</div>
        </div>
    </div>

    <script>
        class ChatApp {
            constructor() {
                this.currentBook = null;
                this.currentChat = 'Dom Casmurro';
                this.userName = 'Eduarda Coimbra';
                this.init();
            }

            init() {
                this.loadBookFromURL();
                this.setupEventListeners();
                this.loadChat();
            }

            loadBookFromURL() {
                const urlParams = new URLSearchParams(window.location.search);
                const bookData = urlParams.get('book');
                
                if (bookData) {
                    try {
                        this.currentBook = JSON.parse(decodeURIComponent(bookData));
                        this.currentChat = this.currentBook.title;
                        this.updateChatTitle();
                    } catch (e) {
                        console.error('Erro ao carregar livro:', e);
                    }
                }
            }

            updateChatTitle() {
                document.getElementById('chatTitle').textContent = `Chat: ${this.currentChat}`;
                document.getElementById('bookChatTitle').textContent = `Chat: ${this.currentChat}`;
                document.getElementById('bookChatSubtitle').textContent = `Discuta sobre "${this.currentChat}" com outros leitores`;
            }

            setupEventListeners() {
                document.getElementById('msgInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.sendMessage();
                    }
                });
            }

            getChatKey() {
                return `chat_${this.currentChat.replace(/\s+/g, '_').toLowerCase()}`;
            }

            loadChat() {
                const area = document.getElementById("chatMessages");
                const messages = JSON.parse(localStorage.getItem(this.getChatKey()) || "[]");

                area.innerHTML = "";

                if (messages.length === 0) {
                    area.innerHTML = '<div class="muted" style="text-align: center; padding: 20px;">Nenhuma mensagem ainda. Seja o primeiro a comentar!</div>';
                    return;
                }

                messages.forEach(msg => {
                    const div = document.createElement("div");
                    div.className = "msg";
                    if (msg.self) div.classList.add("self");

                    div.innerHTML = `<b>${msg.name}</b><br>${msg.text}`;
                    area.appendChild(div);
                });

                area.scrollTop = area.scrollHeight;
            }

            sendMessage() {
                const text = document.getElementById("msgInput").value.trim();
                if (!text) return;

                const messages = JSON.parse(localStorage.getItem(this.getChatKey()) || "[]");

                messages.push({
                    name: this.userName,
                    text: text,
                    self: true,
                    timestamp: new Date().toLocaleTimeString()
                });

                localStorage.setItem(this.getChatKey(), JSON.stringify(messages));
                document.getElementById("msgInput").value = "";
                this.loadChat();
            }

            changeChat(bookTitle) {
                this.currentChat = bookTitle;
                this.updateChatTitle();
                this.loadChat();
            }
        }

        // FunÃ§Ãµes globais para os event listeners do HTML
        function sendMessage() {
            window.chatApp.sendMessage();
        }

        function changeChat(bookTitle) {
            window.chatApp.changeChat(bookTitle);
        }

        // Inicializar o chat
        document.addEventListener('DOMContentLoaded', () => {
            window.chatApp = new ChatApp();
        });
    </script>
</body>
</html>